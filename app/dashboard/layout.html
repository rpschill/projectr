<div layout="row" layout-fill>

    <div ng-controller="DashCtrl as dash" class="app-view" flex layout="row" layout-align="space-around">

        <!--<section class="menus" layout="row" layout-align="start stretch" layout-fill flex> flex="15" style="min-width: 265px;"-->

        <!--<div layout="column" class="menu-columns" layout-fill layout-align="start stretch">-->

        <md-sidenav class="md-sidenav-left" md-component-id="left" md-is-locked-open="$mdMedia('gt-md')" md-whiteframe="1">

            <md-toolbar>
                <div class="md-toolbar-tools">
                    <span>projectr</span>
                    <span flex></span>
                    <md-button class="md-icon-button" ng-click="dash.close()" hide-gt-md>
                        <md-icon md-font-set="material-icons"> close </md-icon>
                    </md-button>
                </div>
            </md-toolbar>

            <div class="folder-header" layout="row" layout-align="space-between center" style="border-bottom: solid 1px rgba(158,158,158,0.2); min-height: 50px;">

                <div style="padding-left: 12px;">
                    <md-icon md-font-set="material-icons" style="font-size: 18px;"> folder </md-icon>
                    Folders
                </div>

                <div class="folder-settings">
                    <md-menu>

                        <md-button class="md-icon-button" ng-click="dash.openMenu($mdOpenMenu, $event)">
                            <md-icon md-font-set="material-icons"> more_horiz </md-icon>
                        </md-button>

                        <md-menu-content>

                            <md-menu-item>
                                <md-button class="md-button-icon" ng-click="dash.addFolder()">
                                    <md-icon md-font-set="material-icons"> create_new_folder </md-icon>
                                    New Folder
                                </md-button>
                            </md-menu-item>

                            <md-menu-item>
                                <md-button ng-click="dash.showDelete = !dash.showDelete">
                                    <md-icon md-font-set="material-icons"> mode_edit </md-icon>
                                    Edit Folders
                                </md-button>
                            </md-menu-item>

                        </md-menu-content>

                    </md-menu>
                </div>

            </div>

            <div class="folder-list" layout="column" flex>

                <md-content flex="auto">

                    <div class="center" ng-hide="dash.folders.length >= 1">
                        <h3>Let's get started!</h3>
                        <p>Click below to create a new folder</p>
                    </div>

                    <md-list ng-show="dash.folders.length >= 1">

                        <md-list-item class="folder-list-item" ng-repeat-start="folder in dash.folders" ng-mouseenter="folder.showProjects = !folder.showProjects"
                            ng-mouseleave="folder.showProjects = !folder.showProjects">

                            <p><strong>{{ folder.title }}</strong></p>

                            <md-button ng-show="folder.showProjects" ng-click="dash.addProject(ev, folder.$id)" class="md-secondary md-icon-button">
                                <md-icon md-font-set="material-icons"> playlist_add </md-icon>
                            </md-button>

                            <md-button ng-show="dash.showDelete" class="md-secondary md-primary md-icon-button" ng-click="dash.deleteFolder(folder, $event)">
                                <md-icon md-font-set="material-icons">
                                    delete </md-icon>
                            </md-button>

                        </md-list-item>

                        <md-list-item ng-repeat-end ng-repeat="project in dash.projects" ng-if="project.folder === folder.$id" ng-click="dash.showTodos(project.$id, project.title, folder.title, folder.$id)"
                            ng-class="{active: project.$id === dash.projId}" style="margin-left: 25px;">
                            <p class="folder-title">{{project.title}}</p>
                            <md-icon md-font-set="material-icons" ng-show="dash.showProjDelete" class="md-secondary md-primary" ng-click="dash.deleteProject(project, $event)">
                                delete </md-icon>
                        </md-list-item>

                    </md-list>

                </md-content>


                <div class="footer-bar" layout="row">
                    <md-menu flex>
                        <md-button class="md-icon-button" style="color: white;" ng-click="dash.openUserMenu($mdOpenMenu, $event)">
                            <md-icon md-font-set="material-icons"> account_box </md-icon>
                        </md-button>

                        <md-menu-content>

                            <md-menu-item>
                                <md-button ng-click="dash.auth.signOut()">
                                    Sign Out
                                </md-button>
                            </md-menu-item>

                            <md-menu-item>
                                <md-button>
                                    Edit Profile
                                </md-button>
                            </md-menu-item>

                        </md-menu-content>
                    </md-menu>
                </div>


                <!--<md-button class="md-primary" ng-click="dash.addFolder($event)">
                        New Folder
                    </md-button>
                    <md-button class="md-primary" ng-click="dash.addProject($event)">
                        New Project
                    </md-button>-->

            </div>

        </md-sidenav>

        <!--</div>-->

        <!--</section>-->

        <section flex layout="column">

            <md-toolbar>
                <div class="md-toolbar-tools">
                    <md-button ng-click="dash.open()" class="md-icon-button" hide-gt-md>
                        <md-icon md-font-set="material-icons"> menu </md-icon>
                    </md-button>
                </div>

            </md-toolbar>

            <span style="height: 15px;" hide show-gt-md></span>

            <div ng-show="dash.todoView" flex layout="row">

                <span hide show-gt-md flex="5"></span>

                <div layout="column" ng-controller="ListCtrl as list" layout-align="start" flex="auto" ng-cloak>

                    <md-content class="md-whiteframe-4dp">
                        <md-subheader class="md-primary" style="background-color: #efefef;">
                            <div layout="row" layout-align="space-between center">

                                <span style="padding-left: 8px;" class="md-primary">{{ dash.folderTitle }} > <strong>{{ dash.projTitle }}</strong></span>
                                <span flex></span>
                                <span>
                                <md-button class="md-primary md-secondary" ng-click="list.addTodo()">
                                    New Task
                                </md-button>
                                <md-button class="md-secondary" ng-click="list.toggleCompleted()">
                                    {{ list.completeText }} Completed
                                </md-button>
                            </span>
                            </div>
                        </md-subheader>

                        <md-divider></md-divider>

                        <md-list focus-iter="[focus-here]">


                            <md-list-item id="{{$index}}" class="todos fade" ng-repeat-start="todo in list.todos | filter : list.projFilter | filter : list.completedFilter"
                                ng-mouseenter="todo.isOpen = !todo.isOpen"
                                ng-mouseleave="todo.isOpen = !todo.isOpen">
                                <md-checkbox class="strikethrough" ng-model="todo.complete" ng-change="list.updateTodo(todo)" ng-repeat="v in [0]"></md-checkbox>
                                <p autofocus class="todo-list-item strikethis" contenteditable ng-model="todo.title" ng-change="list.updateTodo(todo)" on-enter="list.addTodo()"
                                    focus-here delete-task-listener="list.removeTodo(todo)" reset-focus-on-new tab-action="list.addChild(todo.$id)"
                                    focus-this="{{$index}}"></p>

                                <md-datepicker ng-model="list.newDate" value="todo.dueDate" md-open-on-focus ng-show="todo.showDatePicker" ng-change="list.setDueDate(todo)"></md-datepicker>
                                <md-button class="md-secondary md-warn" ng-show="todo.dueDate != '' && !todo.showDatePicker" ng-click="todo.showDatePicker = !todo.showDatePicker">
                                    <md-icon md-font-set="material-icons"> schedule </md-icon>{{todo.dueDate | date: 'EEEE, MMM dd, yyyy'}}</md-button>

                                <md-fab-speed-dial md-direction="left" class="md-scale md-secondary">
                                    <md-fab-trigger>
                                        <md-button aria-label="menu" class="md-icon-button md-warn md-mini">
                                            <md-icon md-font-family="material-icons"> more_horiz </md-icon>
                                        </md-button>
                                    </md-fab-trigger>

                                    <md-fab-actions>
                                        <md-button class="md-fab md-raised md-mini md-danger" ng-click="list.deleteTodo(todo, $event)">
                                            <md-icon md-font-family="material-icons"> delete </md-icon>
                                        </md-button>
                                        <md-button class="md-fab md-raised md-mini" ng-click="list.toggleRight()">
                                            <md-icon md-font-family="material-icons"> hourglass_empty </md-icon>
                                        </md-button>
                                        <md-button class="md-fab md-raised md-mini" ng-click="todo.showDatePicker = !todo.showDatePicker">
                                            <md-icon md-font-family="material-icons"> schedule </md-icon>
                                        </md-button>
                                        <md-button class="md-fab md-raised md-mini" ng-click="list.addChild(todo.$id)">
                                            <md-icon md-font-family="material-icons"> subdirectory_arrow_right </md-icon>
                                        </md-button>
                                    </md-fab-actions>
                                </md-fab-speed-dial>

                                <md-button class="md-icon-button md-secondary" ng-click="dash.openDetail()">
                                    <md-icon md-font-set="material-icons"> chevron_right </md-icon>
                                </md-button>


                                <md-divider md-inset></md-divider>

                            </md-list-item>

                            <md-list-item class="todos child-todos fade" ng-repeat-end ng-repeat="child in list.childTodos | filter : list.completedFilter"
                                ng-if="child.parentId === todo.$id" style="margin-left: 50px;" ng-mouseenter="child.isOpen = !child.isOpen"
                                ng-mouseleave="child.isOpen = !child.isOpen">

                                <md-checkbox class="strikethrough" ng-model="child.complete" ng-change="list.updateChild(child)" ng-repeat="v in [0]"></md-checkbox>
                                <p autofocus class="todo-list-item strikethis" ng-model="child.title" contenteditable focus-here on-enter="list.addChild(todo.$id)"
                                    ng-change="list.updateChild(child)" delete-child-listener="list.removeChild(child)" reset-focus-on-new
                                    shift-tab-action="list.convertToParent(child)" focus-this="{{$index}}"></p>

                                <md-datepicker ng-model="list.newDate" value="child.dueDate" md-open-on-focus ng-show="child.showDatePicker" ng-change="list.setChildDueDate(child)"></md-datepicker>
                                <md-button class="md-secondary md-warn" ng-show="child.dueDate != '' && !child.showDatePicker" ng-click="child.showDatePicker = !child.showDatePicker">
                                    <md-icon md-font-set="material-icons"> schedule </md-icon>{{child.dueDate | date: 'EEEE, MMM dd, yyyy'}}</md-button>

                                <md-fab-speed-dial md-direction="left" class="md-scale md-secondary">
                                    <md-fab-trigger>
                                        <md-button aria-label="menu" class="md-icon-button md-warn md-mini">
                                            <md-icon md-font-family="material-icons"> more_horiz </md-icon>
                                        </md-button>
                                    </md-fab-trigger>

                                    <md-fab-actions>
                                        <md-button class="md-fab md-raised md-mini md-danger" ng-click="list.removeChild(child)">
                                            <md-icon md-font-family="material-icons"> delete </md-icon>
                                        </md-button>
                                        <md-button class="md-fab md-raised md-mini" ng-click="list.toggleRight()">
                                            <md-icon md-font-family="material-icons"> hourglass_empty </md-icon>
                                        </md-button>
                                        <md-button class="md-fab md-raised md-mini" ng-click="child.showDatePicker = !child.showDatePicker">
                                            <md-icon md-font-family="material-icons"> schedule </md-icon>
                                        </md-button>
                                    </md-fab-actions>
                                </md-fab-speed-dial>

                                <md-button class="md-icon-button md-secondary" ng-click="dash.openDetail()">
                                    <md-icon md-font-set="material-icons" ng-show="!dash.isDetailOpen"> chevron_right </md-icon>
                                </md-button>

                                <md-divider md-inset></md-divider>

                            </md-list-item>

                        </md-list>

                    </md-content>

                </div>

                <span flex="5" hide show-gt-md></span>

            </div>

            <span style="height: 15px;" hide show-gt-md></span>

        </section>

        <md-sidenav class="md-sidenav-right md-whiteframe-1dp" md-component-id="todoDetail">
            
            <md-toolbar>
                <div class="md-toolbar-tools">
                    <span flex></span>
                    <md-button class="md-icon-button" ng-click="dash.closeDetail()">
                        <md-icon md-font-set="material-icons"> close </md-icon>
                    </md-button>
                </div>
            </md-toolbar>

            <section>
                <div class="folder-header" layout="row" layout-align="space-between center" style="border-bottom: solid 1px rgba(158,158,158,0.2); min-height: 50px;">
                    <span class="md-primary" style="padding-left: 12px;">Todo item title</span>
                </div>

                <md-content>
                    <md-subheader>
                        Details
                    </md-subheader>

                    <div>
                        Stuff
                    </div>
                    <md-divider></md-divider>

                    <md-subheader>
                        Timers
                    </md-subheader>

                    <div>
                        timer Stuff
                    </div>
                    <md-divider></md-divider>
                </md-content>
            </section>

        </md-sidenav>

    </div>

</div>